FROM node:16.13.0-buster as builder

WORKDIR /home/node

ADD . .

RUN chown -R node:node /home/node/

USER node

ARG REACT_APP_CHAIN_ID=1285
ARG REACT_APP_RPC_URL=https://rpc.api.moonriver.moonbeam.network
ARG REACT_APP_SUBGRAPH_URL=https://moonriver-subgraph.moonsama.com/subgraphs/name/moonsama/marketplacev2
ARG REACT_APP_NFT_SUBGRAPH_URL=https://moonriver-subgraph.moonsama.com/subgraphs/name/moonsama/nft
ARG REACT_APP_BACKEND_API_URL=https://minecraft-metaverse-api.moonsama.com/api/v1
ARG REACT_APP_COMPOSITE_MEDIA_URI_PREFIX=https://dev.static.moonsama.com
ARG REACT_APP_RECAPTCHA_SITEKEY=6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI
ARG DID_CONFIGURATION="eyJAY29udGV4dCI6Imh0dHBzOi8vaWRlbnRpdHkuZm91bmRhdGlvbi8ud2VsbC1rbm93bi9kaWQtY29uZmlndXJhdGlvbi92MSIsImxpbmtlZF9kaWRzIjpbeyJAY29udGV4dCI6WyJodHRwczovL3d3dy53My5vcmcvMjAxOC9jcmVkZW50aWFscy92MSIsImh0dHBzOi8vaWRlbnRpdHkuZm91bmRhdGlvbi8ud2VsbC1rbm93bi9kaWQtY29uZmlndXJhdGlvbi92MSJdLCJpc3N1ZXIiOiJkaWQ6a2lsdDo0bzdhSlVVM1NQWjIxSnZrbVp2d3k4aXI0N3dDeGhFY3RwTjZjd25Zc0U0WnpMWUgiLCJpc3N1YW5jZURhdGUiOiIyMDIyLTExLTI5VDEzOjQwOjEwLjE2N1oiLCJleHBpcmF0aW9uRGF0ZSI6IjIwMjctMTEtMjhUMTM6NDA6MTAuMTY3WiIsInR5cGUiOlsiVmVyaWZpYWJsZUNyZWRlbnRpYWwiLCJEb21haW5MaW5rYWdlQ3JlZGVudGlhbCIsIktpbHRDcmVkZW50aWFsMjAyMCJdLCJjcmVkZW50aWFsU3ViamVjdCI6eyJpZCI6ImRpZDpraWx0OjRvN2FKVVUzU1BaMjFKdmttWnZ3eThpcjQ3d0N4aEVjdHBONmN3bllzRTRaekxZSCIsIm9yaWdpbiI6Imh0dHBzOi8vbWluZWNyYWZ0LW9yYWNsZS11aS1kZXZlbG9wbWVudC5tb29uc2FtYS5jb20iLCJyb290SGFzaCI6IjB4ZGIyNzI3NThkNWI4NzUzMTFiNWRkOTI3MDM1NTIyNWQyZjUyMGRhOGZiOTI0Y2MxNzQ2OTgxZDkwNTRiMzMyYiJ9LCJwcm9vZiI6eyJ0eXBlIjoiS0lMVFNlbGZTaWduZWQyMDIwIiwicHJvb2ZQdXJwb3NlIjoiYXNzZXJ0aW9uTWV0aG9kIiwidmVyaWZpY2F0aW9uTWV0aG9kIjoiZGlkOmtpbHQ6NG83YUpVVTNTUFoyMUp2a21adnd5OGlyNDd3Q3hoRWN0cE42Y3duWXNFNFp6TFlIIzB4OTI3MTdmNGM5ODY3MDM3NjQyOTFiN2E5YTYxMzE4OTU2NjY5MDcxOGQwM2ViNWU3NDY5ZmUzMWYwMTU3M2IyZiIsInNpZ25hdHVyZSI6IjB4OGFmMjU0Njg3YmQzZDJmNTQxNTYyZjkyYzhkZGFlMTA0YmVmZWMxNDExOGExNzc2NmQ0MDFhOTVhNjRkYzYwZWYyOThhOGU2MjNmOWMwZGJkNjFhMTk5MGUzM2IxZDZiOTEyNzkyNWUwZDJlZGI2MDc5ZWYxNGYwMDc5NjhlODQifX1dfQo="
ARG REACT_APP_SQUID_MULTIVERSE_URL=https://squid.subsquid.io/moonsama-multiverse/graphql
ARG REACT_APP_SQUID_RARESAMA_URL=https://squid.subsquid.io/raresama/graphql
ARG REACT_APP_SQUID_EXOSAMA_URL=https://squid.subsquid.io/exosama-squid/graphql
ARG REACT_APP_SUBGRAPH_EXN_URL=https://exosama-subgraph.moonsama.com/subgraphs/name/moonsama/nft-1155-rss-v2
RUN yarn

WORKDIR /home/node/packages/minecraft-oracle-ui

RUN yarn build && \
    mkdir /home/node/packages/minecraft-oracle-ui/build/.well-known && \
    echo $DID_CONFIGURATION | base64 -d > /home/node/packages/minecraft-oracle-ui/build/.well-known/did-configuration.json

FROM nginxinc/nginx-unprivileged:1.21.6-alpine

ADD packages/minecraft-oracle-ui/nginx.conf /etc/nginx/conf.d/default.conf

COPY --from=builder /home/node/packages/minecraft-oracle-ui/build/ /usr/share/nginx/html
